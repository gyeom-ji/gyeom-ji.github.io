---
title: "정규화"
author: gyeomji
date: 2024-07-30 10:00:00 +0900
categories: [Database]
tags: [정규화]
pin: false
math: true
mermaid: true
---

<br/> 

## 이상현상 Anomaly

---

- 데이터의 중복성으로 인해 릴레이션 조작 시 발생하는 이상 현상이다.
- 삽입 이상
  - 불필요한 정보를 저장하지 않고는 어떤 정보를 저장하는 것이 불가능하다.
  - ➡️ 원하지 않는 정보가 강제로 삽입됨
- 삭제 이상
  - 유용한 정보를 삭제하지 않고는 어떤 정보를 삭제하는 것이 불가능하다.
  - ➡️ 원하지 않는 정보가 손실된다. (loss of information)
- 갱신 이상
  - 중복 데이터 중 일부만 갱신하면 데이터 불일치(data inconsistency)가 발생한다.
- 정규화로 이상현상을 해결할 수 있다.

<br/>

### 이상현상 발생 원인

- 잘못 설계된 릴레이션은 불필요한 데이터 중복을 포함한다.
- 데이터 중복으로 인해 하나의 릴레이션에 여러 관계성이 존재하게 된다.
  - 함수 종속, 다치 종속, 조인 종속
- 데이터 중복은 투플 삽입, 삭제, 갱신 시 이상현상(anomaly)을 야기한다.

<br/>

## 정규화 Normalization

---

- 관계형 데이터베이스의 설계에서 데이터의 일관성과 정확성을 유지하도록 데이터베이스의 구조를 결정하는 것이다.
- 속성 간 종속성으로 인한 이상현상이 발생하는 릴레이션을 무손실 분해하여 이상현상을 없애는 과정이다.
- 각종 이상 현상들을 해결할 수 있다. 
- 새로운 속성 추가로 인해 DB 구조를 확장하는 경우, 구조의 변경을 최소화할 수 있다. 
  - DB와 연동된 응용프로그램에 최소한의 영향만을 미쳐 응용프로그램의 생명을 연장시킨다. 
- 정규화된 릴레이션 간의 관계가 현실 세계에서의 개념들간의 관계를 잘 보여준다.
- 릴레이션의 분해로 인해 릴레이션간의 연산이 많아져 응답 시간이 느려질 수 있다.
  - 반정규화(De-normalization)을 통해 성능을 향상시킬 수 있다.

<br/>

### 정규화의 기본 원리

1. 무손실 변환 (Non-loss of information)
    - 분해된 릴레이션이 표현하는 정보는 분해되기 전의 정보를 모두 포함해야 한다.
2. 데이터 중복의 최소화 (Minimal data redundancy)
    - 이상 현상을 제거하고 데이터 중복을 최소화해야한다.
3. 하나의 독립된 관계성은 별도의 릴레이션에 표현 (Principle of separation)


<br/>

### 정규화 유형

![normalization](/assets/img/normalization.png)

<br/>

### 함수 종속성 FD(Functional Dependency)

---

- 릴레이션에서 한 속성(속성 집합)의 값이 다른 속성(속성 집합)의 값을 결정하는 것이다.
- 즉, 어떠한 값을 통해 종속 관계에 있는 다른 값을 유일하게 결정할 수 있는 것이다.
- 어떤 릴레이션 R에서, X와 Y를 각각 R의 속성(attribute) 집합의 부분 집합이라고 할 때, X의 값 각각에 대해 시간에 관계없이 항상 Y의 값이 오직 하나만 연관된 경우에 Y는 X에 함수 종속이라 하고 X → Y 라고 표기한다.
  - X → Y : Y는 X에 함수 종속이다 
  - 이때 속성 X를 결정자(determinant), 속성 Y를 종속자(dependent) 라고 한다.
  - 결정자가 속성 집합이면 복합결정자라 한다.
- 데이터베이스 설계 단계에서 함수 종속 관계에 있는 속성을 찾으면 중복된 데이터를 줄일 수 있기 때문에 설계 단계에서 각 정보들 간 함수 종속 관계를 찾는 것이 매우 중요하다.

<br/>

#### 함수 종속 종류

- 완전 함수 종속 : 기본키를 구성하는 모든 속성에 종속되는 경우
- 부분 함수 종속 : 기본키를 구성하는 속성의 일부에 종속되거나, 기본키가 아닌 다른 속성에 종속되는 경우
- 이행 함수 종속 : 릴레이션에서 X → Y, Y → Z 종속 관계가 있을 때, X → Z가 성립되는 경우


![normalization](/assets/img/normalization1.png)

> 학년은 학번에 함수 종속이다. 즉, 학번을 알고 있다면 학년을 참조하지 않거나 학년 속성을 유지하지 않아도 학년을 결정할 수 있다. 기본키를 (학번, 과목코드)라 할 때 성적은 학번과 과목코드 모두 알아야 유일하게 결정되기 때문에 완전 함수 종속이다. 학년은 학번만 알아도 유일하게 결정되기 때문에 부분 함수 종속이다.

<br/>

#### 함수 종속 규칙

- `반사 규칙` : A ⊇ B ⇒ A → B and A → A
- `첨가 규칙` : A → B ⇒ AC → BC and AC → B 
- `이행 규칙` : A → B and B → C ⇒ A → C
- `분해 규칙` : A → BC ⇒ A → B
- `결합 규칙` :  A → B and A → C ⇔ A → BC

<br/>

### 정규화 과정

1. 1정규형(1NF) : 원자 값이 아닌 도메인을 분해한다.
2. 2정규형(2NF) : 부분 함수 종속을 제거한다. (완전 함수적 종속 관계)
3. 3정규형(3NF) : 이행 함수 종속을 제거한다.
4. 보이스-코드 정규형(BCNF) : 결정자 후보 키가 아닌 함수 종속을 제거한다.
5. 4정규형(4NF) : 함수 종속 아닌 MVD를 제거한다.
6. 5정규형(5NF) : 후보 키를 통하지 않은 JD를 제거한다.

<br/>

### 제1 정규형(First Normal Form)

---

- 릴레이션의 <span style="color:#9fb584">**모든 속성의 속성 값이 모두 원자 값**</span>을 가진다.
- 비정규화 테이블을 다치 속성, 복합 속성을 제거함으로써 1NF로 변환할 수 있다.
    > 비정규화 테이블 : 다치 속성, 복합 속성을 가지는 릴레이션<br/>
    > ![firstNormalForm](/assets/img/firstNormalForm.png){: width="400" height="400"}<br/>
    > ![firstNormalForm](/assets/img/firstNormalForm1.png){: width="400" height="400"}

#### 예시

- 모든 속성이 원자 값을 가지도록 해준다.

![firstNormalForm](/assets/img/firstNormalForm2.png)

<br/>

#### 이상현상

- 기본키에 `부분 함수 종속`인 속성이 존재하기 때문에 삭제, 삽입, 변경 이상 현상이 발생할 수 있다.

![firstNormalForm](/assets/img/firstNormalForm3.png)


<br/>

### Heath의 무손실 분해

---

- 프로젝션으로 분해된 테이블을 자연 조인했을 때 원래의 테이블로 복귀가 가능하면 무손실 분해라고 한다.
- R(A,B,C)에 함수 종속 A → B가 존재하면 ① R1(**A**, B), ② R2(**A**, C)로 무손실분해 가능

#### 예시

- 분해 전: 수강지도(<U>학번</U>, 지도교수, 학과, <U>과목코드</U>, 성적)
- 분해 후: ① 수강(<U>학번, 과목코드</U>, 성적), ② 지도(<U>학번</U>, 지도교수, 학과)

![heath](/assets/img/heath.png)


<br/>

### 제2 정규형(Second Normal Form)

---

- 테이블 분해를 통해 <span style="color:#9fb584">**부분 함수 종속을 제거**</span>하여 1정규형에서의 이상현상을 해결한다.
- 제1 정규형이면서, 기본키(primary key)에 속하지 않은 속성 모두가 기본키에 완전 함수 종속인 정규형이다.

#### 예시

- 모든 속성이 완전 함수 종속이 되도록 릴레이션을 분리한다.

![secondNormalForm](/assets/img/secondNormalForm.png)

<br/>

#### 이상현상

- `이행적 함수 종속`이 존재하기 때문에 삭제, 삽입, 변경 이상 현상이 발생할 수 있다.

![secondNormalForm](/assets/img/secondNormalForm1.png)

<br/>

### 제3 정규형(Third Normal Form)

---

- 테이블 분해를 통해 <span style="color:#9fb584">**이행적 함수 종속을 제거**</span>하여 2정규형에서의 이상현상을 해결한다.
- 제2 정규형이면서, 이행적 함수 종속성을 제거한 정규형이다.
  - 기본키에 속하지 않은 모든 속성이 기본키에 이행적 함수 종속이 아니다.

#### 예시

- 이행적 함수 종속 관계에 있는 속성을 분리한다.

![thirdNormalForm](/assets/img/thirdNormalForm.png)

<br/>

#### 3NF을 적용할 수 없는 경우 (이상현상 발생)

1. 복수의 후보키를 가진 경우
2. 후보키가 복합 속성으로 구성된 경우
    - ex) AK1(<U>a</U>, b), AK2(<U>a</U>, c), AK3(<U>a</U>, d)
3. 후보키에 속하는 속성이 서로 중첩될 경우
    - 2번 예시에서 속성 `a`가 중첩

<br/>

#### 이상현상

- 각 교수는 한 과목만 담당하고 한 과목은 여러 교수가 담당할 수 있다고 가정한다.
  - 후보키 : (학번, 과목), (학번, 담당교수)
    > 후보키 : 투플을 <span style="color:#9fb584">**유일하게 식별할 수 있는 속성의 최소**</span> 집합
- `후보키가 아닌 결정자`가 존재하기 때문에 삭제, 삽입, 변경 이상 현상이 발생할 수 있다.
  - 담당 교수만으로는 후보키가 될 수 없지만 후보키가 아님에도 과목명을 결정할 수 있기 때문에 담당 교수는 결정자에 속한다.

![thirdNormalForm](/assets/img/thirdNormalForm1.png)

<br/>

### 강한 제3 정규형 BCNF(Boyce/Codd Normal Form)

---

- 테이블 분해를 통해 <span style="color:#9fb584">**모든 결정자가 항상 후보키가 되도록**</span>하여 3정규형에서의 이상현상을 해결한다.
- 제3 정규형을 조금 더 강화시킨 개념이다.

<br/>

#### BCNF 알고리즘

1. 모든 함수 종속을 찾는다.
2. 모든 후보 키를 찾는다.
3. <span style="color:#9fb584">**결정자가 후보 키가 아닌 함수 종속에 대해 릴레이션을 분해**</span>한다.
    ① 함수 종속의 속성들을 새 릴레이션로 이동하고, 결정자를 기본 키로 설정한다. <br/>
    ② 함수 종속의 결정자를 원래의 릴레이션에 외래 키로 설정한다.<br/>
    ③ 원래 릴레이션과 새 릴레이션 사이에 참조 무결성 제약조건을 생성한다.<br/>
4. 모든 테이블의 모든 결정자가 후보 키가 된 경우 종료하고 아닐 경우 단계 3번을 다시 진행한다.

<br/>

#### 예시

- 모든 결정자가 항상 후보키가 되도록 테이블을 분리한다.

![bcnf](/assets/img/bcnf.png)

- 1) 함수종속
  - (학번, 과목) → 담당 교수
  - 담당 교수 → 과목
- 2) 후보키
  - (학번, 과목) : 후보키
  - 담당 교수 : 후보키가 아닌 결정자
- 3) 릴레이션 분해
  - 수강교수(<U>학번, 담당 교수</U>)
  - 과목담당(<U>담당 교수</U>, 과목)

![bcnf](/assets/img/bcnf1.png)

- 1) 함수종속
  - (주문번호, 물품) → (수량, 단가, 총액)
  - (수량, 단가) → 총액
- 2) 후보키
  - (주문번호, 물품) : 후보키
  - (수량, 단가) : 후보키가 아닌 결정자
- 3) 릴레이션 분해
  - ExtendedPrice(<U>수량, 단가</U>, 총액)
  - OrderItem(<U>주문번호, 물품</U>, 수량, 단가)

<br/>

#### 이상현상

- <span style="color:#9fb584">**상호 독립적인 일대다(1:N) 관계**</span>에 의해 이상현상이 발생된다.
- 과목 코드는 교수나 교재 값 하나를 결정하는 것이 아니라 <span style="color:#9fb584">**값의 집합(set of values)을 결정**</span>한다.
  - (D001) → {P1, P2}
    - 과목 코드 1 : 교수 N
  - (D001) → {T1, T2}
    - 과목 코드 1 : 교재 N
  - 과목 코드 ↠ 교수\|교재

![bcnf](/assets/img/bcnf2.png)


<br/>

### 다치 종속 MVD (Multi-Valued Dependency)

---

- 릴레이션 R(A, B, C)에서 어떤 (A, C)값에 대응하는 B값의 집합이 A값에만 종속되고 C값에 독립이면, B는 A에 다치 종속이라 하고, A ↠ B 로 표기한다.
  - 즉  (A,C) → { B } ⇒  A ↠ { B }
  - B값의 집합이 A값에만 종속되고 C값에 독립 ex) (과목 코드, 교수) 와 (교재)
  - A ↠ B 로 표기 ex) 과목 코드 ↠ 교재
- A ↠ B ⇒ A ↠ C
  - B, C는 상호 독립적이고, A에만 종속적이다.
  - 항상 쌍으로 존재한다.
  - 즉, A ↠ B\|C
- A → B ⇒ A ↠ B 
  - 모든 FD는 MVD이지만, 역은 성립하지 않는다.

<br/>

##### [ Fagin의 정리 (MVD를 가진 릴레이션의 분해)]

- R(A,B,C)에 MVD A ↠ B\|C가 존재할 때, R1(A, B), R2(A, C)로 무손실 분해가 가능하다.


<br/>

### 제4 정규형(Fourth Normal Form)

---

- 릴레이션 R에서 <span style="color:#9fb584">**A ↠ B (MVD)가 존재할 때 R의 모든 속성들이 A에 함수 종속(FD)**</span>이면 R은 4NF이다.
  - 어떤 릴레이션 R이 4NF이라면 MVD가 없어야 한다.
  - MVD A↠ B\|C가 있을 경우 A에 대응되는 B와 C의 값은 하나씩이어야 한다. (A에 함수 종속)
  - 이때 A는 후보키이다.
- <span style="color:#9fb584">**즉, 릴레이션 R이 BCNF에 속하고 모든 MVD가 FD이면 R은 4NF**</span>이다.

<br/>

#### BCNF를 4NF로 변환하는 방법

1. A↠ B\|C 형태의 MVD를 찾는다.
2. Fagin의 정리에 따라 R을 R1(A, B) 그리고 R2(A, C)로 분해한다.


![fourthNormalForm](/assets/img/fourthNormalForm.png)

<br/>

### 조인 종속 JD(Join Dependency)

---

- n개 이상의 테이블로 분해해야만 정보 무손실 분해가 되는 테이블을 n-decomposable relation이라 한다.
  - n개 미만의 projection으로는 무손실 분해를 할 수 없다.
- R의 속성이 n개의 부분집합 A1, A2, ..., An으로 구성되고, R = A1 ⋈ A2 ⋈ ... ⋈ An 이면 R은 JD *(A1, A2, ..., An)을 만족시킨다고 한다.
- R이 JD *(A1, A2, ..., An)을 만족하면 R은 `n-분해 관계` 이다.

<br/>

#### FD, MVD, JD 사이의 관계

- MVD는 JD의 특별한 형태(2-분해)이다.
- R(A, B, C)가  JD *(AB, AC)을 만족하면 R은 MVD A ↠ B\|C 를 만족한다.
- JD는 가장 일반적인 형태의 종속이다.


<br/>

### 제5 정규형(Fifth Normal Form)

---

- 릴레이션 R에 존재하는 <span style="color:#9fb584">**모든 조인 종속(JD)이 R의 후보 키를 통해서만 만족**</span>되면 R은 5NF에 속한다.
- PJ/NF (Projection Join Normal Form)라고 부르기도 한다.




<br/>
<br/>


[^footnote]: The footnote source
[^fn-nth-2]: The 2nd footnote source