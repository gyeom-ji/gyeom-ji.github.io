---
title: "메모리 관리"
author: gyeomji
date: 2024-05-16 10:00:00 +0900
categories: [Operating System]
tags: [Memory, Operating System]
pin: false
math: true
mermaid: true
---


## 메모리 관리

---

- 운영체제의 핵심 기능 중 하나이다.
- 프로그램의 <span style="color:#9fb584">**실행이 종료될 때까지 메모리를 가용한 상태로 유지 및 관리하는 기능**</span>이다.
- 프로그램 실행 중 메모리가 꽉 차게 되면 시스템의 속도가 느려지고 멈추는 현상이 발생한다.
- <span style="color:#9fb584">**메모리에 있는 프로그램을 CPU로 이동하여 처리**</span>한다.
- <span style="color:#9fb584">**CPU는 가상 주소, 메모리는 물리 주소를 사용하기 때문에 MMU가 주소를 매핑하는 역할을 수행**</span>한다.
    > MMU (Memory Management Unit) : CPU가 메모리에 접근하는 것을 관리하는 컴퓨터 하드웨어 부품으로 가상 메모리 주소를 실 메모리 주소로 변환하는 장치이다.

<br/>

> iOS에서의 메모리 관리는 [ARC(Automatic Reference Counting)](https://gyeom-ji.github.io/posts/arc/)에 의해 수행되며, 메모리 관리 방법으로 Reference Counting을 사용한다.

<br/>

## 메모리 관리 기법

---

### 1. 반입 기법 (When)

- <span style="color:#9fb584">**주기억장치에 적재할 다음 프로세스의 반입 시기를 결정**</span>하는 기법이다.
- 메모리로 적재 시기(When)를 결정한다.

#### 세부 기법

1. 요구 반입 기법
2. 예상 반입 기법

<br/>

### 2. 배치 기법 (Where)

- <span style="color:#9fb584">**디스크에 있는 프로세스를 주기억장치의 어느 위치에 저장할 것인지 결정**</span>하는 기법이다.
- 메모리 적재 위치(Where)를 결정한다.

#### 세부 기법

1. 최초 적합 First-fit
    - 프로세스가 적재될 수 있는 <span style="color:#9fb584">**가용 공간 중 첫 번째 분할에 할당**</span>하는 방식이다.
2. 최적 적합 Best-fit
    - <span style="color:#9fb584">**가용 공간 중에서 가장 크기가 비슷한 공간을 선택**</span>하여 프로세스를 적재하는 방식이다.
   - 공백이 최소화라는 장점이 있다.
3. 최악 적합 Worst-fit
    - 프로세스의 <span style="color:#9fb584">**가용 공간 중 가장 큰 공간에 할당**</span>하는 방식이다.

![memoryFit](/assets/img/memoryFit.png)

<br/>

### 3. 할당 기법 (How)

- <span style="color:#9fb584">**실행해야 할 프로세스를 주기억장치에 어떤 방법으로 할당할 것인지 결정**</span>하는 기법이다.
- 메모리 적재 방법(How)을 결정한다.

#### 세부 기법

1. 연속 할당 기법
   - 실행을 위한 각 프로세스를 주기억장치 공간 내에서 인접되게 연속하여 저장하는 방법
   - 연속 할당 기법은 프로세스를 주기억장치에 연속으로 할당하는 기법이다.
   - 단일 분할 할당 기법과 다중 분할 할당 기법이 있다.
   - 단일 분할 할당 기법 : 오버레이, 스와핑
   - 다중 분할 할당 기법 : 고정 분할 할당 기법, 동적 분할 할당 기법
<br/>
2. 분산 할당 기법
    - 하나의 프로세스를 여러 조각으로 나눠 주기억장치 공간 내 분산하여 배치하는 기법이다.
    - 주로 <span style="color:#9fb584">**가상기억장치에서 사용**</span>한다.
    - 페이징 기법, 세그먼테이션 기법, 페이징/세그먼터이션 기법이 있다.

<br/>

1) 페이징 기법 Paging
 - 가상기억장치 내 프로세스를 <span style="color:#9fb584">**일정한 페이지 단위로 분할**</span>해 주기억장치의 분산된 공간에 적재시킨 후 프로세스를 수행시키는 기법이다.
 - 이 방식의 가상 메모리는 항상 0번지부터 시작한다.
 - 페이지로 영역을 나누는 이유는 공간적 지역성 때문이다.
 - 페이징 기법은 프로세스가 생길 때마다 매 번 일정 크기만큼 나누기 때문에 실제 프로세스 크기가 작은 경우 <span style="color:#9fb584">**할당된 영역이 낭비되는 내부 단편화가 발생**</span>할 수 있다.
 
 <br/>
2) 세그먼테이션 기법 Segmentation
 - 가상기억장치 내 프로세스를 <span style="color:#9fb584">**가변적인 크기의 세그먼트로 나눠**</span> 메모리를 할당하는 기법이다.
 - 즉, 크기가 큰 프로세스는 그만큼 많은 영역을 할당받는다.
 - 분할 형태가 배열, 함수와 같은 논리적인 다양한 크기의 가변적인 크기로 관리한다.
 - 잦은 메모리 할당, 해제로 인해 중간중간 빈 공간이 생기는 상황이 발생하는데, <span style="color:#9fb584">**새로 할당하기엔 작은 공간이지만 무시할 수 없는 영역들이 생기는 외부 단편화가 발생**</span>할 수 있다.

 <br/>
3) 페이징/세그먼테이션 혼용 기법
- 외부 단편화 및 내부 단편화 최소화를 위해 세그먼테이션 기법과 페이징 기법을 결합하였다.

<br/>

### 4. 교체 기법 (Who)

- <span style="color:#9fb584">**재배치 기법으로 주기억장치에 있는 프로세스 중 어떤 프로세스를 제거할 것인지 결정**</span>하는 기법이다.
- 메모리 교체 대상(Who)을 결정한다.

#### 세부 기법

1. 프로세스의 Swap In/Out
2. FiFo (First In First Out)
    - 각 페이지가 주기억장치에 적재될 때마다 <span style="color:#9fb584">**가장 먼저 들어온 페이지**</span>를 교체하는 기법
3. LRU (Least Recently Used)
    - <span style="color:#9fb584">**가장 오랫동안 사용되지 않은 페이지**</span>를 교체하는 방법
    - 프로그램의 지역성의 원리에 따라 최근에 참조된 페이지는 앞으로도 참조될 가능성이 크고, 최근에 참조되지 앟은 페이지는 그렇지 않을 가능성이 크다는 전제로 구현된 알고리즘
4. LFU (Least Frequently Used)
    - <span style="color:#9fb584">**참조 횟수가 가장 적은 페이지**</span>를 교체하는 방법
5. OPT (OPTimal Replacement)
    - <span style="color:#9fb584">**앞으로 가장 오랫동안 사용하지 않을 페이지**</span>를 교체하는 방법
    - 페이지 부재 횟수가 가장 적게 발생하는 효율적인 알고리즘
6. NUR (Not Used Recently)
    - LRU와 유사한 알고리즘으로, <span style="color:#9fb584">**최근에 사용하지 않은 페이지**</span>를 교체하는 방법
    - LRU에서 나타나는 시간적인 오버헤드를 줄일 수 있다.
    - 최근 사용 여부를 확인하기 위해 페이지마다 참조 비트와 변형 비트를 사용한다.
7. SCR (Second Chance Replacement)
    - <span style="color:#9fb584">**가장 오랫동안 주기억장치에 있던 페이지 중, 자주 사용되는 페이지의 교체를 방지**</span>하기 위한 기법으로 FIFO의 단점을 보완한다.

<br/>

### 5. 메모리 단편화

- 분할된 주기억장치에 프로세스를 할당, 반납하는 과정에서 사용되지 못하고 <span style="color:#9fb584">**낭비되는 기억장치가 발생**</span>하는 현상이다.
- 내부 단편화와 외부 단편화가 있다.

#### 내부 단편화

- 분할된 공간에 <span style="color:#9fb584">**프로세스를 적재한 후 남은 공간**</span>이다.
- <span style="color:#9fb584">**고정 분할 할당 방식, 페이징 기법**</span> 사용 시 발생한다.
- 해결방안으로는 Slab Allocator, 통합/압축이 있다.
- Slab Allocator
  - 페이지 프레임을 할당받아 공간을 작은 크기로 분할하고 메모리 요청 시 작은 크기로 메모리를 할당, 해제하는 동적 메모리 관리 기법이다.
- 통합 Coalescing
  - 인접한 단편화 영역을 찾아 하나로 통합하는 기법이다.
- 압축 Compaction
  - 메모리의 모든 단편화 영역을 하나로 압축하는 기법이다.

#### 외부 단편화

- 할당된 크기가 <span style="color:#9fb584">**프로세스 크기보다 작아 사용하지 못하는 공간**</span>이다.
- <span style="color:#9fb584">**가변 분할 할당 방식 또는 세그먼테이션 기법**</span> 사용시 발생한다.
- 해결방안으로는 버디 메모리 할당, 통합/압축이 있다.
- 버디 메모리 할당 (Buddy Memory Allocation)
  - 메모리를 2n의 크기로 분할해 메모리를 할당하는 기법이다.

<br/>

### 6. 페이징 기법의 문제 및 해결방안

#### 페이징 기법의 문제 : 스레싱 Thrashing

- 어떤 프로세스가 계속적으로 페이지 부재가 발생해 <span style="color:#9fb584">**프로세스의 실제 처리 시간보다 페이지 교체 시간이 더 많아지는 현상**</span>이다.
- 오류율이 클수록 스레싱이 많이 발생한 것이고, 이로 인해 전체 시스템 성능 및 처리율이 저하된다.
- <span style="color:#9fb584">**페이지 부재가 계속 증가하여 기억장치 접근 시간이 증가**</span>한다.
  

<br/>

#### 스레싱 해결방안 1 : 워킹 세트 Working Set

- 각 프로세스가 <span style="color:#9fb584">**많이 참조하는 페이지들의 집합을 주기억장치 공간에 계속 상주하게 해 빈번한 페이지 교체 현상을 줄이는 기법**</span>이다.

|장점|단점|
|:------|:------|
| 멀티프로그래밍 정도를 높일 수 있다.(Page Hit 증가)<br/> CPU 활용률을 최적화할 수 있다.| 워킹 세트 추적관리가 복잡하다.<br/> 워킹 세트 크기 설정의 모호함이 발생한다.|


<br/>

#### 스레싱 해결방안 2 : 페이지 부재 빈도 PFF(Page-Fault Frequency)

- <span style="color:#9fb584">**페이지 부재율의 상한, 하한을 정해 직접적으로 페이지 부재율을 예측하고 조절**</span>하는 기법이다.
- 페이지 부재 비율에 따라 페이지 프레임 개수를 조절한다.

|장점|단점|
|:------|:------|
| 페이지 부재 발생 시 실행하여 부하가 적다.<br/> 직접적으로 페이지 부재율 조절이 가능하다.| 프로세스를 중지 시키는 과정이 발생한다.<br/> 페이지 참조가 새로운 지역성으로 이동할 수 있다.|

<br/> 

### 7. 지역성

- 지역성은 프로세스가 실행되는 동안 주기억장치를 참조할 때 <span style="color:#9fb584">**일부 페이지만 집중적으로 참조**</span>하는 특성이다,
- 프로세스가 집중적으로 사용하는 페이지를 알아내는 방법 중 하나다.
- 참조 지역성이라고도 불리며 시간 지역성, 공간 지역성, 순차 지역성이 있다.
- 지역성을 활용해 기억/저장 장치의 계층적 구조와 캐시 메모리, 가상 메모리의 기법들로 효율성의 극대화가 가능하다.



|유형|설명|사례|
|:------:|:------|:------|
|시간 지역성| 최근 사용되었던 기억장소들이 집중적으로 액세스하는 현상<br/> 참조했던 메모리는 빠른 시간에 다시 참조될 확률이 높은 특성|Loop, Stack, Sub Routine, Counting, 집계에 사용되는 변수|
|공간 지역성| 프로세스 실행 시 일정 위치의 페이지를 집중적으로 액세스하는 현상<br/> 참조된 메모리 근처의 메모리를 참조하는 특성|배열 순회, 같은 영역에 있는 변수 참조|
|순차 지역성| 데이터가 순차적으로 액세스 되는 현상<br/> 프로그램 내 명령어가 순차적으로 구성된 특성|순차적 코드 실행|


<br/> 

[^footnote]: The footnote source
[^fn-nth-2]: The 2nd footnote source
